steps:
- download:  current
  artifact: 'base_branch_snapshot'
  displayName: "Download base branch snapshot"
  continueOnError: true

- script: |
    set -x

    if [ -e "$(Pipeline.Workspace)/base_branch_snapshot/snapshot.env" ]; then
      echo "File exists."
    else
      echo "File does not exist."
    fi

    # Step 1: Fetch PR References
    git fetch --all
    # Step 2: Get commit SHAs
    TARGET_BRANCH=$(git rev-parse origin/master)
    # Step 3: Save the snapshot
    echo "TARGET_BRANCH=$TARGET_BRANCH" >> $(Build.ArtifactStagingDirectory)/snapshot.env
  displayName: "Get base branch snapshot"

- publish:  $(Build.ArtifactStagingDirectory)
  artifact: 'base_branch_snapshot'
  displayName: "Archive base branch snapshot"
