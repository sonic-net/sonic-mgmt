steps:

- checkout: self
  clean: true
  displayName: 'checkout sonic-mgmt repo'

- script: |
    sudo docker pull sonicdev-microsoft.azurecr.io:443/docker-sonic-mgmt:latest
    sudo docker run -dt -v $(pwd):/var/src/sonic-mgmt --name sonic-mgmt-collect \
      sonicdev-microsoft.azurecr.io:443/docker-sonic-mgmt:latest /bin/bash
  displayName: 'Prepare sonic-mgmt docker container'

- script: |
    docker exec -t -w /var/src/sonic-mgmt/tests sonic-mgmt-collect \
      sudo pytest --inventory ../ansible/veos_vtb --host-pattern all \
      --testbed_file vtestbed.yaml --testbed vms-kvm-t0 \
      --ignore saitests --ignore ptftests --ignore acstests \
      --ignore scripts --ignore k8s --ignore sai_qualify --ignore common \
      --ignore-conditional-mark \
      --color=no --collect-only --continue-on-collection-errors
  displayName: 'Run pytest --collect-only'
