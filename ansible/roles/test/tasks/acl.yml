
#-----------------------------------------
# Run all the acl tests.
#-----------------------------------------

- set_fact:
    run_dir: "{{ '/home/admin/acl_tests' }}"
    out_dir: "{{ '/home/admin/acl_tests/results' }}"
    docker_testdir: "{{ '/tmp' }}"
    logfile: "{{ '' }}"
    tests_location: "{{ 'roles/test/tasks/acl' }}"

- set_fact:
    run_config_test: "{{ tests_location }}/run_config_test.yml"
    run_config_cleanup: "{{ tests_location }}/run_config_cleanup.yml"
    run_loganalyzer: "{{ tests_location }}/run_loganalyzer.yml"
    set_ports_speed: "{{ tests_location }}/set_ports_speed.yml"

- name: Create run_dir
  file: path="{{ run_dir }}" state=directory

 #****************************************#
 #           Start tests                  #
 #****************************************#

- block:
    - name: Test file input.
      include: "{{ tests_location }}/acl_input_test/acl_input_test.yml"

    - name: Test port bind configuration.
      include: "{{ tests_location }}/acl_port_bind_test/acl_port_bind_test.yml"

    - name: Test orchagent logic.
      include: "{{ tests_location }}/acl_orchagent_logic_test/acl_orchagent_logic_test.yml"

    - name: Test traffic.
      include: "{{ tests_location }}/acl_traffic_test/acl_traffic_test.yml"

    - name: Test counters traffic.
      include: "{{ tests_location }}/acl_counter_traffic_test/acl_counter_traffic_test.yml"

  always:
    - name: General cleanup.
      file: path="{{ item }}" state=absent
      with_items:
        - "{{ run_dir }}/loganalyzer.py"

