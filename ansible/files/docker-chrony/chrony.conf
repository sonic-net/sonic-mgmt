# Chrony configuration for SONiC Virtual Testbed NTP Server
# This server provides NTP time sync for DUTs on the management network

# Upstream NTP servers to sync from
# Using pool.ntp.org for reliable time sources
pool pool.ntp.org iburst maxsources 4
pool time.google.com iburst maxsources 2

# Fallback to local clock if external sources are unavailable
# This ensures DUTs can still sync even without internet connectivity
local stratum 10

# Allow NTP clients on the management networks
# IPv4 management network (10.250.0.0/24)
allow 10.250.0.0/24

# IPv6 management network (fec0::/10 - site-local)
allow fec0::/10

# Also allow localhost
allow 127.0.0.0/8
allow ::1/128

# Record the rate at which the system clock gains/loses time
driftfile /var/lib/chrony/drift

# Enable kernel synchronisation of the real-time clock (RTC)
rtcsync

# Allow stepping the system clock during the first updates
makestep 1.0 3

# Enable logging
log tracking measurements statistics

# Specify the location of the log files
logdir /var/log/chrony

# Listen on all interfaces
bindaddress 0.0.0.0
bindaddress ::

# Serve time even if not synchronized (for isolated networks)
local stratum 10 orphan

# Rate limiting for NTP clients
ratelimit interval 1 burst 16
