This document describes the list of additional system testcases.

- [Background](#background)
- [Setup](#setup)
- [Testcases](#testcases)


### Background

Intent of these testcases is to test throughput at the interface speed, PFC, PFC-WD, ECN congestion, port-channels and MACSEC. These testcases will be executed for 100 and 400Gbps ports on single line-card single asic, single line-card multiple asic and multiple line-card. The packet-size will vary from 128 to 1400 bytes.

Test cases are specifically meant for Multi-ASIC, DNX based chassis platform.

Traffic pattern includes at least one lossless priority flow and with/without lossy background traffic. Some of the testcases use pause flows to simulate congestion.

Additionally, the testcases also intend to capture the utilization, packet-drops and/or latency.


### Setup

Example for 100Gbps:
                                
                                ________________
                                |               |
    IXIA(100Gbps) <--------->   |    DUT-LC1    |<---------> IXIA(100Gbps)
    IXIA(100Gbps) <--------->   |    ASIC0      |<---------> IXIA(100Gbps)
                                |_______________|
                                |_______________|
                                |               |
    IXIA(100Gbps) <--------->   |    DUT-LC1    |
    IXIA(100Gbps) <--------->   |    ASIC1      |
                                |_______________|

                                ________________
                                |               |
    IXIA(100Gbps) <--------->   |    DUT-LC2    |<---------> IXIA(100Gbps)
                                |    ASIC0      |
                                |_______________|


There will be similar setup on a different line-cards for 400Gbps in the same chassis.

### Testcases

| Test case ID | Testcase Groups          | Description                                                                                                                                                                                                                                                                                                               | Topology                                                                                                                                                                                                                               | Traffic Pattern and Settings                                                                                                                                                                                                                                           | LC combination                                                                   | Pass-Fail Criteria                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |  
|-------------:|:-------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           01 | NON-CONGESTION(NORMAL)   | **NO CONGESTION AT LINE RATE TEST:**<br>Aim of the test is to ensure that there are no packet drops with equal speed ingress and egress links and mix of lossless and lossy traffic. No packet drops for both lossless and lossy priority traffic.                                                                        | - Single 100Gbps Ingress and egress <br>- Repeat with 400Gbps ingress and egress port <br>- Frame size: IMIX packet-profile.                                                                                                           | - 90% of ingress interface speed - Lossless Priority 3 and 4<br>- 10% of ingress interface speed - Lossy Background Flow [Priority 0, 1, and 2]                                                                                                                        | - Single LC - Multiple ASIC <br>- Single LC - Single ASIC <br>- Multiple LC      | 1. There should be NO packet drops on the DUT (Tool Tx packets == Tool Rx packets) <br>2. There should no PFCs on tool Tx port or on the DUT. <br>3. Measure latency of the packets traversing the DUT. <br>4. Expected throughput of linerate on the egress port of DUT.                                                                                                                                                                                                                      |
|           02 | NON-CONGESTION(MACSEC)   | **NO CONGESTION LINE-RATE OVER MACSEC ENABLED LINK:**<br>Test case to ensure that there are no packet drops with equal speed ingress and egress links with MACSEC enabled and mix of lossless and lossy traffic.                                                                                                          | - Single 100Gbps Ingress and single 100Gbps egress - MACSEC <br>- Repeat with Single 400Gbps ingress and Single 400Gbps egress - MACSEC. <br>- Repeat with IPv6 <br>- Frame size: IMIX packet-profile.                                 | - 90% - Lossless Priority 3 and 4<br>- 10% - Lossy Background Flow [Priority 0, 1, and 2]                                                                                                                                                                              | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. There should be NO packet drops on the DUT (IXIA Tx packets == IXIA Rx packets) <br>2. There should no PFCs on IXIA Tx port or on the DUT.<br>3. Measure latency of the packets traversing the DUT. <br>4. Expected throughput of linerate on the egress port of DUT.                                                                                                                                                                                                                       |
|           03 | CONGESTION               | **DETECT CONGESTION WITH MISMATCHED INGRESS AND EGRESS:**<br> Aim of the test is ensure that congestion with ingress 400Gbps link and single 100Gbps egress link and mix of lossless and lossy traffic.No losses for lossless priorities (Priority 3 and 4) traffic streams.                                              | - Single 400Gbps Ingress and single 100Gbps egress <br>- Repeat with IPv6 <br>- 1024B packet-size                                                                                                                                      | - 90% of 400Gbps - Lossless Priority 3 and 4<br>- 10% of 400Gbps - Lossy Background Flow [Priority 0, 1, and 2]                                                                                                                                                        | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. The single 100Gbps egress should see 100Gbps lossy+lossless traffic<br>2. The 40Gbps lossy traffic should be continue to flow.<br>3. The traffic transmitter port should be receiving PFCs for the lossless priority traffic.<br>4. On receiving the PFCs, the IXIA-ingress should reduce the lossless traffic to around 60Gbps.<br>5. No drop for lossy and lossless traffic.                                                                                                              |
|           04 | CONGESTION               | **DETECT CONGESTION WITH REAL-LIFE TRAFFIC PATTERN - 90% LOSSLESS and 10% LOSSY:**<br>Aim of the testcase is to ensure that congestion is detected with two ingress and single egresses of same speed and mix of lossless and lossy traffic. No losses for lossless priority traffic (Priority 3 and priority 4 streams). | - Two 100Gbps Ingress and single 100Gbps egress <br>- Repeat test with 2x400Gbps ingress and 1x400Gbps egress <br>- IMIX packet-profile <br>- Unequal traffic lossy and lossless priorities.                                           | - 90% - Lossless Priority 3 and 4 per ingress LC <br>- 10% - Lossy Background Flow [Priority 0, 1, and 2] per ingress LC.                                                                                                                                              | - Single LC - Multiple ASIC <br>- Single LC - Single ASIC <br>- Multiple LC      | 1. No packet drops for Lossy Traffic. <br>2. PFCs for lossless traffic sent from DUT ingress to traffic transmitter. No packet drops for losslesss traffic. <br>3. Expected throughput of (Lossless + lossy traffic only) on egress interface line rate of DUT.                                                                                                                                                                                                                                |
|           05 | CONGESTION               | **DETECT CONGESTION WITH EQUAL DISTRIBUTION OF LOSSLESS AND LOSSY TRAFFIC:**<br> Purpose of the testcase is to determine that amount of congestion faced by both lossless and lossy priority traffic. No losses for priority 3 and priority 4 traffic streams.                                                            | - Two 100Gbps Ingress and single 100Gbps egress <br>- Repeat test with 2x400Gbps ingress and 1x400Gbps egress <br>- IMIX packet-profile <br>- Equal traffic for all priorities                                                         | - 24% -  Priority 3 and 4 per ingress LC <br>- 36% Background flows [Priority 0, 1, and 2] per ingress LC <br>- Enabled PFCWD and credit-watchdog on ingress and egress.                                                                                               | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. Packet drops for Lossy Traffic. <br>2. PFCs for lossless traffic. No packet drops for losslesss traffic. <br>3. Expected throughput of egress interface line-rate (Lossless + lossy traffic only) on egress interface of DUT. <br>4. Expected close to equal throughput for all priorities.                                                                                                                                                                                                 |
|           06 | CONGESTION (MACSEC)      | **CONGESTION DETECTION WITH PAUSE FRAMES OVER MACSEC ENABLED LINK:** <br>Purpose of the test is to ensure that congestion is detected on DUT egress with MACSEC enabled links on ingress and egress and mix of lossless and lossy traffic. No drops for lossless priority traffic.                                        | - Single 100Gbps Ingress and Egress - PFC over MACSEC. <br> - Repeat with 400Gbps Ingress and Egress <br> - 1024B packet-size                                                                                                          | - 90% - Lossless Priority 3 and 4 per ingress LC <br>- 10% - Lossy Background Flow [Priority 0, 1, and 2] <br>- Disable PFCWD before the test <br>- Send PAUSE frames to egress interface of DUT.                                                                      | - Single LC - Multiple ASIC <br>- Single LC - Single ASIC <br>- Multiple LC      | 1. There should be NO packet drops on the DUT (IXIA Tx packets == IXIA Rx packets)<br>2. There should be PFCs on IXIA and DUT - Tx and Rx port. <br>3. No Lossless Priority traffic on IXIA Rx Interface. <br> 4. Only 10% lossy priority traffic allowed from the DUT. <br>5. No loss for Lossless traffic.                                                                                                                                                                                   |
|           07 | CONGESTION (MACSEC)      | **CONGESTION OVER MISMATCHED INGRESS AND EGRESS MACSEC ENABLED LINK:**<br>Test case to check if the DUT detects congestion due to mismatched MACSEC enabled link speeds and sends PFCs to rate-limit the lossless priority traffic.                                                                                       | - Single 400Gbps Ingress and single 100Gbps egress <br> - Repeat with IPv6 <br>- 1024B packet-size.                                                                                                                                    | - 90% - ingress line rate Priority 3 and 4 <br>- 10% of ingress line-rate -- Background Flow[Priority 0, 1, and 2]                                                                                                                                                     | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. There should be NO packet drops on the DUT for both Lossless and lossy priority traffic.<br>2. DUT should send PFCs to the traffic generator to rate-limit the lossless priority traffic.<br>3. 100Gbps Egress port should receive Lossless Priority 3 and 4 traffic.                                                                                                                                                                                                                       |
|           08 | CONGESTION (PC)          | **UNEQUAL SPEED INGRESS-EGRESS PORTCHANNEL CONGESTION TEST:**<br>Test case to check that DUT detects congestion due to mismatched ingress and egress port-channel speeds and send PFCs to the ingress to rate-limit the lossless priority traffic. No drops for the lossless priority traffic.                            | - Port-channel - N x 100Gbps Ingress - 400Gbps Egress with N > 4. <br>- 1024B packet-size.                                                                                                                                             | - 90% of total ingress port-channel link- Priority 3 and 4 <br>- 10% of ingress port-channel link- Background Flow[Prio0, 1, and 2]                                                                                                                                    | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. The lossless Prio3-4 traffic should not experience drop.<br>2. Ensure that background flows experience drop.<br>3. DUT sends PFCs to traffic generator to rate-limit the lossless prio traffic.                                                                                                                                                                                                                                                                                             |
|           09 | CONGESTION (PC + MACSEC) | **CONGESTION DETECTION ON PORT FAILURE ON PORTCHANNEL WITH MACSEC ENABLED:**<br>Test case to verify that DUT detects congestion on egress port-channel link on port-failure with MACSEC enabled on port-channel.                                                                                                          | - Minimum of Two x 100Gbps ingress and egress port with MACSEC and PFC-WD enabled.<br>- Min port set to 1 for this test <br>- Repeat with minimum 2x400Gbps ingress and egress ports as port-channel members. <br>- 1024B packet-size. | - 90% - Lossless Priority 3 and 4<br>- 10% - Lossy Background Flow[Prio0, 1, and 2]<br>- Shutdown one of the egress ports.<br>- Shutting one of egress port causing congestion on other egress port.<br>- Bring back the egress port online again <br> Repeat in loop. | - Single LC - Multiple ASIC<br>Multiple LC                                       | 1. Line-rate should be 200Gbps without any PFCs or packet drops. <br>2. When one of egress ports is shut,  PFCs should be sent to the ingress to slow down the incoming traffic.<br>3. The other egress port should receive all the Lossless Priority 3 and 4 traffic.<br>4. Miniscule drop for both lossless and lossy traffic while traffic is shifting to other egress port. <br> 5. When egress port is back-online, the traffic on egress ports should switch back with no loss or drops. |
|           10 | PFCWD                    | **PFCWD ENABLED DROP MODE TEST:**<br> Purpose of the test case is to ensure that lossless priorities are dropped when PFCWD is enabled and egress ports faces PFC storm. DUT does not send PFCs out of ingress port and no drops for lossy traffic.                                                                       | - Two 100Gbps Ingress and single 100Gbps egress <br>- Repeat test with 2x400Gbps ingress and 1x400Gbps egress <br>-Repeat with IPv6. <br>- 1024B packet-size                                                                           | - 30% - Lossless Priority 3 and 4 per ingress LC <br>- 10% Lossy Background Flow [Priority 0, 1, and 2] per ingress LC. <br>- Enable PFCWD with "action" set to DROP(default)<br>- Send continuous PFC for lossless Priorities for configured interval.                | - Single LC - Multiple ASIC <br>- Single LC - Single ASIC <br>- Multiple LC      | 1. No lossy background flows dropped on DUT when the PFC is sent to DUT egress. Egress port is in 'stormed' mode. <br>2. Lossless flows are dropped on DUT. <br>3. PFCWD drop counter should increment. <br> 4. No PFCs are sent from DUT ingress to traffic transmitter. <br>5. After the PFC packets are stopped, the egress port is moves to "operational state" and storm-restored counter increments.                                                                                     |           
|           11 | PFCWD                    | **PFCWD ENABLED FORWARD MODE TEST:**<br>Test case to ensure that both lossless and lossy priority traffic are forwarded when PFCWD is enabled in forward mode and egress ports faces PFC storm. DUT does not send PFCs out of ingress port and no drops for both lossy and lossless traffic.                              | - Two 100Gbps Ingress and single 100Gbps egress <br>- Repeat test with 2x400Gbps ingress and 1x400Gbps egress <br>- 1024B packet-size                                                                                                  | - 30% - Lossless Priority 3 and 4 per ingress LC <br>- 10% Lossy Background Flow [Priority 0, 1, and 2] per ingress LC. <br>- Enable PFCWD with "action" set to FORWARD <br>- Send continuous PFC for lossless Priorities for configured interval.                     | - Single LC - Multiple ASIC <br>- Single LC - Single ASIC <br>- Multiple LC      | 1. There should be no packet drops on DUT for lossy background flows. <br>2. The Priority 3 and 4 packets are forwarded to the Traffic Receiver. <br>3. After the PFC packets are stopped, the lossless PRIO traffic should continue without any drops.<br>4. No PFCs sent from DUT ingress to traffic transmitter. <br>5. PFCWD drop counters should not increment.                                                                                                                           |         
|           12 | PFCWD (MACSEC)           | **TEST PFCWD BEHAVIOR OVER MACSEC ENABLED LINK:** <br>Aim of the test case is to ensure that PFCWD drops the lossless priority traffic on detecting PFC storm on MACSEC enabled DUT and mix of lossless and lossy traffic.                                                                                                | - Single 100Gbps Ingress and single 100Gbps egress - PFCWD(Drop) over MACSEC <br>- Repeat with Single 400Gbps ingress and Single 400Gbps egress. <br> - 1024B packet-size.                                                             | - 90% - Lossless Priority 3 and 4<br>- 10% - Lossy Background Flow [Priority 0, 1, and 2] <br>3. Enabled PFCWD in default mode before the test. <br>4. Send pause to the egress interface of DUT from IXIA Rx.                                                         | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. There should be packet drops on the DUT (IXIA Tx packets > IXIA Rx packets). <br>2. There should PFCs on DUT egress but no PFC sent from DUT ingress to traffic transmitter. <br>3. Only 10% of lossy traffic should flow. <br>4. PFCWD drop counter should increment <br>5. DUT Rx port should be in 'stormed' mode.                                                                                                                                                                       |
|           13 | ECN                      | **APPROPRIATE ECN MARKING ON CONGESTION RESTORATION:**<br>Aim of the test case is to ensure that DUT marks the lossless priority traffic with appropriate ECN flags when congestion is detection and restoration.                                                                                                         | - Single 100Gbs ingress and single 100Gbps egress <br>- Repeat with 400Gbps ingress and egress. <br>- 1024B packet-size <br>- ECN congestion and packet-marking test.<br>                                                              | - Disable PFCWD <br>- 90% - Lossless Priority 3 and 4<br>- 10% - Lossy Background Flow [Priority 0, 1, and 2] <br>- Send PFC storm to the egress implying ECN congestion. <br>- Stop the PFC storm. <br>- Monitor set of packets to ensure packets are ECN-marked.     | - Single LC - Multiple ASIC <br>- Multiple LC                                    | 1. PFC storm should stop the packets coming DUT ingress. <br>2. No packets going out of egress port during storm. <br>3. The captured packet on egress, once storm is stopped should be ECN-marked.                                                                                                                                                                                                                                                                                            |         






